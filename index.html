<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Result Scanner</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; padding: 20px; }
    h2 { color: #333; }
    #reader { width: 320px; margin: 20px auto; }
    .card {
      background: white;
      padding: 20px;
      margin-top: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: inline-block;
      text-align: left;
    }
    p { margin: 6px 0; }
  </style>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h2>ðŸŽ“ Scan QR to View Result</h2>
  <div id="reader"></div>
  <div id="result"></div>

<script>
  // Google Sheet ID à¤¸à¥‡ à¤²à¤¿à¤‚à¤• à¤¬à¤¨à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾ à¤¹à¥ˆ
  const sheetURL = "https://docs.google.com/spreadsheets/d/1vpWiNeyz4YUDSkTsgrekglJts1cP8ByolR-QnOHzwo0/gviz/tq?tqx=out:csv";

  async function fetchData() {
    const res = await fetch(sheetURL);
    const data = await res.text();
    const rows = data.split("\n").map(r => r.split(","));
    const headers = rows[0].map(h => h.trim());
    const records = rows.slice(1).map(r => {
      const obj = {};
      headers.forEach((h, i) => obj[h] = r[i] ? r[i].trim() : "");
      return obj;
    });
    return records;
  }

  function showData(record) {
    document.getElementById("result").innerHTML = `
      <div class="card">
        <h3>${record["Name"]}</h3>
        <p><b>Father Name:</b> ${record["Father Name"]}</p>
        <p><b>Student ID:</b> ${record["Student id"]}</p>
        <p><b>Course:</b> ${record["Course"]}</p>
        <p><b>Grade:</b> ${record["Grade"]}</p>
        <p><b>Date of Issue:</b> ${record["Date of Issue"]}</p>
      </div>`;
  }

  async function onScanSuccess(qrCodeMessage) {
    const records = await fetchData();
    const record = records.find(r => r["QR"] === qrCodeMessage.trim());
    if (record) showData(record);
    else document.getElementById("result").innerHTML = "<p style='color:red'>No result found!</p>";
  }

  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    onScanSuccess
  );
</script>
</body>
</html>
