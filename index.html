<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skill Centerr ┬╖ рдкрд░рд┐рдгрд╛рдо рдХрд╛рд░реНрдб</title>
  <style>
    body {
      font-family: "Noto Sans Devanagari", Arial, sans-serif;
      background: #faf5ff;
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #4a148c;
      font-weight: 700;
      margin-bottom: 5px;
    }
    p { color: #333; }
    #reader {
      width: 320px;
      margin: 20px auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .card {
      background: white;
      padding: 20px;
      margin: 30px auto;
      border-radius: 16px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      max-width: 700px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #e1bee7;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f3e5f5;
      color: #4a148c;
    }
    .buttons { margin-top: 20px; }
    button {
      background: #7b1fa2;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      margin: 5px;
      cursor: pointer;
    }
    button:hover { background: #9c27b0; }
    .notfound { color: red; font-weight: bold; }
    footer { margin-top: 25px; color: #777; font-size: 13px; }
  </style>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>

  <h2>ЁЯОУ Skill Centerr ┬╖ рдкрд░рд┐рдгрд╛рдо рдХрд╛рд░реНрдб</h2>
  <p>QR рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рдкреЗрдЬ рдЦреБрд▓рддрд╛ рд╣реИред рдиреАрдЪреЗ рдЖрдкрдХреА рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рд╡ рдкрд░рд┐рдгрд╛рдо рджрд┐рдпрд╛ рд╣реИред</p>

  <div id="reader"></div>
  <div id="result"></div>

<script>
  // ЁЯФ╣ рдЕрдкрдиреА Google Sheet рдХрд╛ CSV рд▓рд┐рдВрдХ рдбрд╛рд▓реЗрдВ
  const sheetURL = "https://docs.google.com/spreadsheets/d/1vpWiNeyz4YUDSkTsgrekglJts1cP8ByolR-QnOHzwo0/gviz/tq?tqx=out:csv";

  async function fetchData() {
    const res = await fetch(sheetURL);
    const data = await res.text();
    const rows = data.split("\n").map(r => r.split(","));
    const headers = rows[0].map(h => h.trim());
    const records = rows.slice(1).map(r => {
      const obj = {};
      headers.forEach((h, i) => obj[h] = r[i] ? r[i].trim() : "");
      return obj;
    });
    return records;
  }

  function showData(record) {
    document.getElementById("reader").style.display = "none";
    let subjectsHTML = "";

    for (let i = 1; i <= 10; i++) {  // 10 рддрдХ subjects рдХреА рдЬрдЧрд╣
      const subj = record[`Subject ${i}`];
      const marks = record[`Marks ${i}`];
      if (subj && marks) {
        subjectsHTML += `<tr><td>${subj}</td><td>${marks}</td></tr>`;
      }
    }

    document.getElementById("result").innerHTML = `
      <div class="card">
        <table>
          <tr><th>рд╡рд┐рджреНрдпрд╛рд░реНрдереА</th><td>${record["Name"]}</td></tr>
          <tr><th>рдкрд┐рддрд╛ рдХрд╛ рдирд╛рдо</th><td>${record["Father Name"]}</td></tr>
          <tr><th>рдЖрдИрдбреА</th><td>${record["Student id"]}</td></tr>
          <tr><th>рд░реЛрд▓</th><td>${record["Roll No"]}</td></tr>
          <tr><th>рдХрдХреНрд╖рд╛</th><td>${record["Class"]}</td></tr>
          <tr><th>рдмреИрдЪ</th><td>${record["Batch"]}</td></tr>
          <tr><th>рдХреЛрд░реНрд╕</th><td>${record["Course"]}</td></tr>
          <tr><th>рдкрд░рд┐рдгрд╛рдо рддрд┐рдерд┐</th><td>${record["Date of Issue"]}</td></tr>
        </table>

        <h3 style="margin-top:20px; color:#6a1b9a;">рд╡рд┐рд╖рдпрд╡рд╛рд░ рдЕрдВрдХ</h3>
        <table>
          <tr><th>рд╡рд┐рд╖рдп</th><th>рдЕрдВрдХ</th></tr>
          ${subjectsHTML || `<tr><td colspan="2">рдЕрдВрдХ рдбреЗрдЯрд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ</td></tr>`}
          <tr><th>рдХреБрд▓</th><td>${record["Total"] || "тАФ"}</td></tr>
          <tr><th>рдХреБрд▓ рдореЗрдВ рд╕реЗ</th><td>${record["Out of"] || "тАФ"}</td></tr>
          <tr><th>рдЧреНрд░реЗрдб</th><td>${record["Grade"] || "тАФ"}</td></tr>
        </table>

        <div class="buttons">
          <button onclick="window.print()">ЁЯЦия╕П рдкреНрд░рд┐рдВрдЯ / PDF</button>
          <button onclick="shareLink()">ЁЯФЧ рд▓рд┐рдВрдХ рд╢реЗрдпрд░ рдХрд░реЗрдВ</button>
          <button onclick="copyLink()">ЁЯУЛ рд▓рд┐рдВрдХ рдХреЙрдкреА рдХрд░реЗрдВ</button>
        </div>
      </div>
    `;
  }

  function showNotFound(id) {
    document.getElementById("result").innerHTML =
      `<p class='notfound'>тЭМ рд░рд┐рдХреЙрд░реНрдб рдирд╣реАрдВ рдорд┐рд▓рд╛ (${id})</p>`;
  }

  function copyLink() {
    navigator.clipboard.writeText(window.location.href);
    alert("рд▓рд┐рдВрдХ рдХреЙрдкреА рд╣реЛ рдЧрдпрд╛!");
  }

  function shareLink() {
    if (navigator.share) {
      navigator.share({
        title: "Result - Skill Centerr",
        url: window.location.href
      });
    } else {
      copyLink();
    }
  }

  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }

  async function onScanSuccess(qrCodeMessage) {
    const records = await fetchData();
    const qrValue = qrCodeMessage.trim().toLowerCase();
    const record = records.find(r => (r["Student id"] || "").toLowerCase() === qrValue);
    if (record) showData(record);
    else showNotFound(qrCodeMessage);
  }

  (async () => {
    const id = getQueryParam("id");
    if (id) {
      const records = await fetchData();
      const record = records.find(r => (r["Student id"] || "").toLowerCase() === id.toLowerCase());
      if (record) showData(record);
      else showNotFound(id);
    } else {
      const html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScanSuccess
      );
    }
  })();
</script>

<footer>
  ┬й 2025 Skill Centerr | Powered by osifbd.github.io
</footer>
</body>
</html>
